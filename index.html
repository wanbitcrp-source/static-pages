<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HTML é™æ€æ‰˜ç®¡å¹³å°</title>
    <style>
        :root { --primary: #2563eb; --bg: #f8fafc; }
        body { font-family: system-ui, -apple-system, sans-serif; background: var(--bg); color: #1e293b; line-height: 1.5; padding: 2rem; }
        .container { max-width: 800px; margin: 0 auto; }
        header { text-align: center; margin-bottom: 3rem; }
        h1 { font-size: 2.25rem; font-weight: 800; color: #0f172a; margin-bottom: 0.5rem; }
        
        .upload-card { background: white; padding: 2rem; border-radius: 1rem; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1); margin-bottom: 3rem; border: 2px dashed #cbd5e1; }
        .upload-card h2 { margin-top: 0; font-size: 1.25rem; margin-bottom: 1.5rem; }
        .form-group { margin-bottom: 1rem; }
        label { display: block; font-size: 0.875rem; font-weight: 600; margin-bottom: 0.5rem; }
        input[type="text"], input[type="file"], input[type="password"] { width: 100%; padding: 0.625rem; border: 1px solid #d1d5db; border-radius: 0.5rem; box-sizing: border-box; }
        button { background: var(--primary); color: white; border: none; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; cursor: pointer; width: 100%; transition: opacity 0.2s; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }

        .app-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 1.5rem; }
        .app-card { background: white; padding: 1.5rem; border-radius: 0.75rem; border: 1px solid #e2e8f0; text-decoration: none; color: inherit; transition: all 0.2s; }
        .app-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); }
        .app-card h3 { margin: 0; font-size: 1.125rem; color: var(--primary); }
        .app-card p { margin: 0.5rem 0 0; font-size: 0.875rem; color: #64748b; }
        
        #status { margin-top: 1rem; font-size: 0.875rem; padding: 1rem; border-radius: 0.5rem; display: none; }
        .success { background: #dcfce7; color: #166534; display: block !important; }
        .error { background: #fee2e2; color: #991b1b; display: block !important; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>ğŸš€ HTML æ‰˜ç®¡å¹³å°</h1>
        <p>ä¸Šä¼  HTML æ–‡ä»¶ï¼Œå³åˆ»å…¨ç½‘è®¿é—®</p>
    </header>

    <div class="upload-card">
        <h2>ğŸ“¤ ä¸Šä¼ æ–°é¡µé¢</h2>
        <div class="form-group">
            <label>GitHub ä»¤ç‰Œ (PAT)</label>
            <input type="password" id="token" placeholder="è¾“å…¥ä½ çš„ github_pat_..." value="">
            <p style="font-size: 12px; color: #64748b;">ä»¤ç‰Œä¿å­˜åœ¨æµè§ˆå™¨æœ¬åœ°ï¼Œä»…ç”¨äºä¸Šä¼ ä»£ç ã€‚</p>
        </div>
        <div class="form-group">
            <label>åº”ç”¨åç§° (æ–‡ä»¶å¤¹å)</label>
            <input type="text" id="appName" placeholder="ä¾‹å¦‚ï¼šmy-game">
        </div>
        <div class="form-group">
            <label>é€‰æ‹© HTML æ–‡ä»¶</label>
            <input type="file" id="fileInput" accept=".html">
        </div>
        <button id="uploadBtn" onclick="handleUpload()">å¼€å§‹éƒ¨ç½²</button>
        <div id="status"></div>
    </div>

    <h2>ğŸ“¦ å·²æ‰˜ç®¡çš„åº”ç”¨</h2>
    <div class="app-list" id="appList">
        <!-- åŠ¨æ€åŠ è½½ -->
        <a href="calculator/" class="app-card">
            <h3>ğŸ”¢ åœ¨çº¿è®¡ç®—å™¨</h3>
            <p>åŸºç¡€æ•°å­¦å·¥å…·</p>
        </a>
        <a href="kinship/" class="app-card">
            <h3>ğŸ§§ äº²æˆšç§°å‘¼æŸ¥è¯¢</h3>
            <p>è¿‡å¹´å¿…å¤‡æŒ‡å—</p>
        </a>
    </div>
</div>

<script>
    // åˆå§‹åŒ– Token (å¦‚æœæœ¬åœ°æœ‰å­˜è¿‡)
    document.getElementById('token').value = localStorage.getItem('gh_token') || '';

    async function handleUpload() {
        const token = document.getElementById('token').value;
        const appName = document.getElementById('appName').value.trim();
        const fileInput = document.getElementById('fileInput');
        const status = document.getElementById('status');
        const btn = document.getElementById('uploadBtn');

        if (!token || !appName || !fileInput.files[0]) {
            alert('è¯·å®Œæ•´å¡«å†™ä¿¡æ¯ï¼');
            return;
        }

        localStorage.setItem('gh_token', token);
        btn.disabled = true;
        btn.innerText = 'æ­£åœ¨ä¸Šä¼ åˆ° GitHub...';
        status.className = '';
        status.innerText = 'æ­£åœ¨è¯»å–æ–‡ä»¶å¹¶è”ç³» GitHub API...';
        status.style.display = 'block';

        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = async (e) => {
            const content = e.target.result.split(',')[1]; // Base64 content
            const path = `${appName}/index.html`;
            const owner = 'wanbitcrp-source';
            const repo = 'static-pages';

            try {
                // 1. å°è¯•ä¸Šä¼ æ–‡ä»¶ (PUT)
                const response = await fetch(`https://api.github.com/repos/${owner}/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Upload ${appName} via web platform`,
                        content: content
                    })
                });

                if (response.ok) {
                    status.className = 'success';
                    status.innerHTML = `âœ… éƒ¨ç½²æˆåŠŸï¼<br>åœ°å€ï¼š<a href="${appName}/" target="_blank">ç‚¹å‡»è®¿é—® ${appName}</a><br>è¯·ç­‰å¾… 1 åˆ†é’Ÿå·¦å³ç”Ÿæ•ˆã€‚`;
                    // åŠ¨æ€æ·»åŠ åˆ°åˆ—è¡¨ (ä»…å½“å‰é¢„è§ˆ)
                    addCardToList(appName);
                } else {
                    const err = await response.json();
                    throw new Error(err.message || 'ä¸Šä¼ å¤±è´¥');
                }
            } catch (error) {
                status.className = 'error';
                status.innerText = 'âŒ é”™è¯¯: ' + error.message;
            } finally {
                btn.disabled = false;
                btn.innerText = 'å¼€å§‹éƒ¨ç½²';
            }
        };

        reader.readAsDataURL(file);
    }

    function addCardToList(name) {
        const list = document.getElementById('appList');
        const card = document.createElement('a');
        card.className = 'app-card';
        card.href = `${name}/`;
        card.innerHTML = `<h3>ğŸ†• ${name}</h3><p>åˆšåˆšéƒ¨ç½²çš„æ–°åº”ç”¨</p>`;
        list.prepend(card);
    }
</script>

</body>
</html>