<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>亲戚称呼专家 | 动态字典版</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: #F8F9FA;
            --primary: #007AFF;
            --text: #1C1C1E;
            --text-secondary: #8E8E93;
            --border: #E5E5EA;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: var(--bg); color: var(--text); display: flex; justify-content: center; min-height: 100vh; }
        .app { width: 100%; max-width: 500px; background: white; display: flex; flex-direction: column; box-shadow: 0 0 20px rgba(0,0,0,0.05); }
        header { padding: 20px; border-bottom: 1px solid var(--border); text-align: center; }
        h1 { font-size: 18px; font-weight: 700; }
        .content { padding: 20px; flex-grow: 1; overflow-y: auto; }
        .section-title { font-size: 13px; font-weight: 700; color: var(--text-secondary); margin-bottom: 12px; }
        
        /* 根人选择 */
        .root-selector { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 24px; }
        .chip { padding: 10px 16px; background: var(--bg); border-radius: 12px; font-size: 14px; font-weight: 600; cursor: pointer; border: 1px solid var(--border); transition: 0.2s; }
        .chip.selected { background: var(--primary); color: white; border-color: var(--primary); }

        /* 关系网展示 */
        .relation-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 12px; }
        .relation-card { padding: 16px; border: 1px solid var(--border); border-radius: 16px; background: white; transition: 0.2s; cursor: pointer; display: flex; flex-direction: column; gap: 4px; }
        .relation-card:hover { border-color: var(--primary); transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.05); }
        .rel-path { font-size: 11px; color: var(--text-secondary); font-weight: 500; }
        .rel-name { font-size: 16px; font-weight: 800; color: var(--text); }

        .search-box { margin-bottom: 20px; position: relative; }
        .search-input { width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid var(--border); outline: none; font-size: 14px; background: #F2F2F7; }

        .empty { text-align: center; padding: 40px; color: var(--text-secondary); }
    </style>
</head>
<body>
<div class="app">
    <header><h1>亲戚称呼全集 (动态版)</h1></header>
    <div class="content">
        <div class="section-title">第一步：选择“谁在叫人”</div>
        <div class="root-selector" id="root-selector">
            <!-- 动态生成 -->
        </div>

        <div class="search-box">
            <input type="text" class="search-input" id="search" placeholder="输入你想找的亲戚称呼，如'叔叔'..." oninput="renderRelations()">
        </div>

        <div class="section-title">第二步：直接查看/选择</div>
        <div class="relation-grid" id="relation-grid">
            <!-- 动态生成 -->
        </div>
    </div>
</div>

<script>
let fullDict = {};
let currentRoot = '';

const rootEl = document.getElementById('root-selector');
const gridEl = document.getElementById('relation-grid');
const searchEl = document.getElementById('search');

// 加载字典并初始化
fetch('data.json')
    .then(r => r.json())
    .then(data => {
        fullDict = data;
        const roots = Object.keys(data);
        currentRoot = roots[0];
        
        // 渲染根选择器
        roots.forEach(r => {
            const chip = document.createElement('div');
            chip.className = `chip ${r === currentRoot ? 'selected' : ''}`;
            chip.innerText = r;
            chip.onclick = () => {
                currentRoot = r;
                document.querySelectorAll('.chip').forEach(c => c.classList.remove('selected'));
                chip.classList.add('selected');
                renderRelations();
            };
            rootEl.appendChild(chip);
        });
        
        renderRelations();
    });

function renderRelations() {
    gridEl.innerHTML = '';
    const query = searchEl.value.toLowerCase();
    const relations = fullDict[currentRoot];
    
    if (!relations) return;

    // 解析路径的辅助函数
    const map = {'父':'爸','母':'妈','兄':'哥','弟':'弟','姐':'姐','妹':'妹','妻':'妻','夫':'夫','子':'儿','女':'女'};

    const keys = Object.keys(relations);
    let found = false;

    keys.forEach(path => {
        const name = relations[path];
        const pathText = path.split('').map(c => map[c] || c).join(' 的 ');
        
        if (pathText.includes(query) || name.includes(query)) {
            found = true;
            const card = document.createElement('div');
            card.className = 'relation-card';
            card.innerHTML = `
                <div class="rel-path">${currentRoot} 的 ${pathText}</div>
                <div class="rel-name">${name}</div>
            `;
            gridEl.appendChild(card);
        }
    });

    if (!found) {
        gridEl.innerHTML = '<div class="empty">未找到相关关系，请尝试其他关键词</div>';
    }
}
</script>
</body>
</html>